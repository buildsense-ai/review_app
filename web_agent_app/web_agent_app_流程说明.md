# web_agent_app 流程说明（轻技术，重过程）

本文面向非技术读者，聚焦端到端过程与业务效果，尽量减少技术细节。它描述 web_agent_app 如何围绕“客观性论断”的事实支撑，通过权威来源的网络检索完成证据收集、支持度评估与内容增强，并输出可交付的分析与增强文档。

---

## 1. 背景与目标
- 目标：对文档中的“需事实支撑的论断”进行证据验证与补强，提升内容的可信度与专业度。
- 范围：侧重事实性与引用性内容的核实与增强，不做语言风格润色或改写；面向报告、白皮书、研究综述等包含大量客观论断的文档。

## 2. 适用场景
- 需要对外发布并经受审核的专业文档（如行业报告、技术白皮书、政策建议稿）。
- 需要在提交前进行“论据体检”，快速发现缺乏支撑的论断并补充权威证据。

## 3. 流程总览
- 步骤 1：识别客观性论断（抽取需要证据的句子/段落）
- 步骤 2：为每条论断进行网络证据搜索（权威来源优先）
- 步骤 3：评估证据支持度并形成摘要（权威性/相关性）
- 步骤 4：内容增强（在保持结构与风格一致的前提下补充/强化）
- 步骤 5：文档合并与交付（增强版全文、简化证据分析、统一结构数据）

## 4. 端到端流程详解
### 4.1 输入与预处理
- 输入：原始文档（纯文本或 Markdown；也可为 JSON 内容并提取文本）。
- 预处理：对全文长度与格式进行基础检查，必要时按章节划分以便并行处理。

### 4.2 处理模式选择
- 全文模式：一次性对整篇文档进行论断识别与证据处理（适合较短文档）。
- 章节并行模式：按一级标题拆分章节并并行处理（推荐，适合中长文档，提升效率）。

### 4.3 论断识别（检测客观性论断）
- 目标：找出需要事实、数据或引用支撑的句子/段落；避免纯观点或主观描述。
- 产出：每章的“待验证/补充”论断清单（含文本、重要度、识别置信度）。

### 4.4 网络证据搜索（权威来源优先）
- 策略：围绕论断生成关键词，调用内部搜索 API 检索多引擎结果（Google/Bing 等），并按权威域名与相关性打分。
- 产出：检索结果列表（标题、摘要、链接、来源域名、权威性评分、相关性评分）。

### 4.5 支持度评估与证据摘要
- 评估维度：来源权威性（如学术/政府/国际组织）与论断相关性（语义匹配、上下文一致）。
- 证据摘要：聚合 Top 结果生成可读性摘要，明确“支撑程度”与引用线索，便于审阅与采纳。

### 4.6 内容增强（保留结构与术语一致）
- 范围：仅对存在“证据缺口或表述薄弱”的片段进行增强；其余内容保持原样。
- 原则：
  - 不捏造事实、不改动已有数据/引用；用权威来源补充论据链。
  - 保持章节结构、语气风格、术语一致性；增强文本可直接替换对应片段。
- 容错：若增强质量不达标或未找到合适证据，则保留原文并在分析中透明标注。

### 4.7 文档合并与交付
- 合并方式：将各章节增强结果直接合为完整 Markdown 文档；支持按照原有章节顺序合并。
- 交付内容：
  - 增强版全文（Markdown）。
  - 简化证据分析（JSON，仅包含论断与证据结果，便于快速审阅）。
  - 统一结构数据（JSON，包含原文、增强片段、证据摘要、章节统计等，便于系统集成）。

### 4.8 输出存放位置
- 统一输出目录：`e:\gaosi\review_app\router\outputs\web_evidence`（增强文档与证据分析文件）。

## 5. 输入与输出
- 输入：
  - 原始文档文本（必需）。
  - 运行参数（最大论断数、每条论断的最大搜索结果数、是否启用章节并行）。
- 输出：
  - 增强版文档（`enhanced_document_*.md`）。
  - 证据分析文件（`evidence_analysis_*.json`）。
  - 统一结构结果（用于系统消费与指标追踪）。
  - 处理统计（章节数、检测到的论断数、证据条数、耗时）。

## 6. 质量保障与边界
- 不做：事实校对（超出可检索证据范围）、数据更新、语言风格润色、主观观点改写。
- 保持：术语一致、章节结构与风格稳定；增强严格基于权威证据。
- 兜底：增强失败或不合规不替换原文；证据不足的论断保留并标注。

## 7. 并发与性能
- 并发粒度：优先按章节并行，必要时对论断检索并行。
- 策略取舍：在速度与稳定性之间做权衡；默认设置偏保守，可按任务规模调整。
- 进度与统计：跟踪每章/每条论断的处理状态与耗时，支持审阅复核。

## 8. 集成与调用（轻技术表述）
- 对外能力：
  - 证据搜索接口（单次查询检索权威结果）。
  - 完整流水线接口（同步或异步），输出增强文档与统一结构 JSON。
- 部署对接：作为内部模块由路由服务统一暴露 API；也可在本地脚本模式运行（如 `run_evaluator.py`）。

## 9. 运行与验证（示例指导）
- API 集成：在集成环境调用“流水线处理”，按章节并行提升处理速度，生成增强文档与证据分析文件。
- 本地脚本：在 `e:\gaosi\review_app\web_agent_app` 目录下运行现有脚本，完成端到端处理并生成输出到统一目录。
- 验证建议：
  - 先对 1–2 章做小样本验证，检查证据摘要的可读性与增强片段是否贴合原文风格。
  - 扩大到整本文档，抽查权威来源与链接有效性，确认引用线索完备。

## 10. 成功标准与业务价值
- 成功标准：
  - 缺乏证据的论断明显减少，增强片段具有明确引用线索。
  - 文档可信度与专业度提升，审阅通过率提高，补改工作量下降。
  - 输出结构清晰、可复用，便于后续指标统计与系统集成。
- 业务价值：
  - 提高文档可信度与交付确定性，降低人工检索与校对成本。
  - 支持标准化、可复核的证据引入流程，缩短发布周期。

---

附注：本文聚焦流程与交付，不涉及模型参数、提示词细节或代码实现；如需技术版说明或图示化流程（泳道图/流程图），可继续补充。